<?php
/**
 * @file
 * Code for the GSB Feature Event Content Type feature.
 */

include_once 'gsb_feature_event_ct.features.inc';

/**
 * Implementation of hook_module_implements_alter()
 */
function gsb_feature_event_module_implements_alter(&$implementations, $hook) {
  if ($hook == 'form_alter') {
    if (isset($implementations['gsb_feature_event'])) {
      $group = $implementations['gsb_feature_event'];
      unset($implementations['gsb_feature_event']);
      $implementations['gsb_feature_event'] = $group;
    }
  }
}

/**
 * Implements hook_form_FORM_ID_alter() for event node edit form.
 */
function gsb_feature_event_ct_form_event_node_form_alter(&$form, &$form_state) {

  $language = $form['language']['#value'];

  if (!empty($form['field_person_fac_other'][$language])) {

    foreach ($form['field_person_fac_other'][$language] as $index => $data) {

      if (is_integer($index)) {

        $form['field_person_fac_other'][$language][$index]['field_person_fac_single_ref']['#states'] = array(
          'visible' => array(
            ':input[name="field_person_fac_other[' . $language . '][' . $index . '][field_person_fac_or_other][' . $language . ']"]' => array(
              array('value' => 'UseEntityReference'),
            ),
          ),
        );

        $form['field_person_fac_other'][$language][$index]['field_first_name']['#states'] = array(
          'visible' => array(
            ':input[name="field_person_fac_other[' . $language . '][' . $index . '][field_person_fac_or_other][' . $language . ']"]' => array(
              array('value' => 'Other'),
            ),
          ),
        );

        $form['field_person_fac_other'][$language][$index]['field_last_name']['#states'] = array(
          'visible' => array(
            ':input[name="field_person_fac_other[' . $language . '][' . $index . '][field_person_fac_or_other][' . $language . ']"]' => array(
              array('value' => 'Other'),
            ),
          ),
        );

        // remove "n/a" as an option for the fac_or_other
        unset($form['field_person_fac_other'][$language][$index]['field_person_fac_or_other'][$language]['#options']['_none']);

      }

    }
  }
}
